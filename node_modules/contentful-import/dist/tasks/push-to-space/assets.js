'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.processAssets = processAssets;

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _getEntityName = require('contentful-batch-libs/dist/get-entity-name');

var _getEntityName2 = _interopRequireDefault(_getEntityName);

var _logging = require('contentful-batch-libs/dist/logging');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function processAssets(assets, { timeout, retryLimit } = {}) {
  return _bluebird2.default.map(assets, asset => {
    _logging.logEmitter.emit('info', `Processing Asset ${(0, _getEntityName2.default)(asset)}`);
    const processingOptions = Object.assign({}, timeout && { processingCheckWait: timeout }, retryLimit && { processingCheckRetry: retryLimit });
    return asset.processForAllLocales(processingOptions).catch(err => {
      err.entity = asset;
      _logging.logEmitter.emit('error', err);
      return _bluebird2.default.resolve(null);
    });
  }, { concurrency: 4 });
}